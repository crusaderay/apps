<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Store Screenshot Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0; /* Changed to light gray */
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: 0 auto;
        }
        h1, h2 {
            color: #0056b3;
        }
        .upload-section {
            margin-bottom: 20px;
            border: 1px dashed #ccc;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .upload-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .upload-section input[type="file"] {
            margin-top: 10px;
        }
        .screenshot-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .screenshot-item {
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 5px;
            background-color: #f9f9f9;
            width: calc(50% - 10px);
            box-sizing: border-box;
        }
        .screenshot-item img {
            max-width: 150px; /* Smaller preview size for uploaded images */
            max-height: 300px;
            height: auto;
            display: block;
            margin: 0 auto 10px auto; /* Center the image */
            border: 1px solid #ddd;
        }
        .screenshot-item textarea {
            width: 100%;
            height: 60px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            resize: vertical;
        }
        .controls {
            margin-top: 20px;
            text-align: center;
        }
        .controls button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .output-section {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .output-section .generated-screenshot {
            border: 1px solid #ccc;
            margin-bottom: 15px;
            padding: 10px;
            text-align: center;
        }
        .output-section .generated-screenshot img {
            max-width: 150px; /* Smaller preview size for generated images */
            max-height: 300px;
            height: auto;
            border: 1px solid #ddd;
        }
        .download-buttons {
            margin-top: 15px;
            text-align: center;
        }
        .download-btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            text-decoration: none;
            color: white;
        }
        .download-btn:active {
            transform: translateY(0);
        }
        .download-all-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
            margin-top: 20px;
            padding: 12px 30px;
            font-size: 16px;
        }
        .download-all-btn:hover {
            box-shadow: 0 6px 20px rgba(240, 147, 251, 0.4);
        }
        .resolution-select {
            margin-bottom: 20px;
            text-align: center;
        }
        .resolution-select label {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>App Store Screenshot Generator</h1>
        <p>Upload your iPhone or iPad screenshots and add text descriptions to generate App Store compliant screenshots.</p>

        <div class="resolution-select">
            <label for="resolution">Select Device Size:</label>
            <select id="resolution">
                <option value="6.9">iPhone 6.9" (1320 Ã— 2868px)</option>
                <option value="6.5">iPhone 6.5" (1242 Ã— 2688px)</option>
                <option value="ipad-12.9">iPad 12.9" Portrait (2064 Ã— 2752px)</option>
                <option value="ipad-12.9-landscape">iPad 12.9" Landscape (2752 Ã— 2064px)</option>
                <option value="ipad-13">iPad 13" Portrait (2048 Ã— 2732px)</option>
                <option value="ipad-13-landscape">iPad 13" Landscape (2732 Ã— 2048px)</option>
            </select>
        </div>

        <div class="upload-section">
            <label for="screenshotUpload">Upload up to 10 Screenshots (iPhone: up to 10, iPad: up to 3):</label>
            <input type="file" id="screenshotUpload" accept="image/*" multiple>
        </div>

        <div id="screenshotPreviews" class="screenshot-preview"></div>

        <div class="controls">
            <button id="generateBtn">Generate App Store Screenshots</button>
        </div>
        
        <div class="controls" id="downloadAllContainer" style="display: none;">
            <button id="downloadAllBtn" class="download-btn download-all-btn">ðŸ“¦ Download All as ZIP</button>
        </div>

        <div class="output-section" id="outputSection">
            <h2>Generated Screenshots</h2>
            <div id="generatedScreenshots"></div>
        </div>
    </div>


    <!-- Add JSZip library for real ZIP functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        const screenshotUpload = document.getElementById('screenshotUpload');
        const screenshotPreviews = document.getElementById('screenshotPreviews');
        const generateBtn = document.getElementById('generateBtn');
        const generatedScreenshotsDiv = document.getElementById('generatedScreenshots');
        const resolutionSelect = document.getElementById('resolution');

        let uploadedFiles = [];

        screenshotUpload.addEventListener('change', (event) => {
            const files = Array.from(event.target.files);
            const selectedResolution = resolutionSelect.value;
            const isIpad = selectedResolution.startsWith('ipad');
            const maxFiles = isIpad ? 3 : 10;
            
            // Validate file count limit based on device type
            if (files.length > maxFiles) {
                alert(`You can upload a maximum of ${maxFiles} images for ${isIpad ? 'iPad' : 'iPhone'}!`);
                event.target.value = ''; // Clear the input
                return;
            }
            
            // Validate file types
            const validFiles = files.filter(file => file.type.startsWith('image/'));
            if (validFiles.length !== files.length) {
                alert('Please upload only image files!');
                event.target.value = ''; // Clear the input
                return;
            }
            
            // Validate file sizes (max 10MB per file)
            const oversizedFiles = validFiles.filter(file => file.size > 10 * 1024 * 1024);
            if (oversizedFiles.length > 0) {
                alert('Some files are too large! Maximum file size is 10MB.');
                event.target.value = ''; // Clear the input
                return;
            }
            // Clear previous uploads to prevent memory leaks
            uploadedFiles.forEach(file => {
                if (file.objectURL) {
                    URL.revokeObjectURL(file.objectURL);
                }
            });
            
            uploadedFiles = validFiles.slice(0, maxFiles); // Limit based on device type
            displayPreviews();
        });

        function displayPreviews() {
            screenshotPreviews.innerHTML = '';
            uploadedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const item = document.createElement('div');
                    item.classList.add('screenshot-item');
                    item.innerHTML = `
                        <img src="${e.target.result}" alt="Screenshot ${index + 1}">
                        <textarea placeholder="Enter screenshot description..." data-index="${index}" maxlength="500"></textarea>
                    `;
                    screenshotPreviews.appendChild(item);
                };
                reader.onerror = (error) => {
                    console.error(`Error reading file ${file.name}:`, error);
                    alert(`Error reading file: ${file.name}`);
                };
                reader.readAsDataURL(file);
            });
        }

        generateBtn.addEventListener('click', async () => {
            // Prevent multiple clicks during generation
            if (generateBtn.disabled) return;
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            
            generatedScreenshotsDiv.innerHTML = '';
            const selectedResolution = resolutionSelect.value;
            let targetWidth, targetHeight;

            if (selectedResolution === '6.9') {
                targetWidth = 1320;
                targetHeight = 2868;
            } else if (selectedResolution === '6.5') {
                targetWidth = 1242;
                targetHeight = 2688;
            } else if (selectedResolution === 'ipad-12.9') {
                targetWidth = 2064;
                targetHeight = 2752;
            } else if (selectedResolution === 'ipad-12.9-landscape') {
                targetWidth = 2752;
                targetHeight = 2064;
            } else if (selectedResolution === 'ipad-13') {
                targetWidth = 2048;
                targetHeight = 2732;
            } else if (selectedResolution === 'ipad-13-landscape') {
                targetWidth = 2732;
                targetHeight = 2048;
            }

            const screenshotItems = document.querySelectorAll('.screenshot-item');
            if (screenshotItems.length === 0) {
                alert('Please upload screenshots first!');
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate App Store Screenshots';
                return;
            }

            try {
                for (let i = 0; i < screenshotItems.length; i++) {
                    const imgElement = screenshotItems[i].querySelector('img');
                    const description = screenshotItems[i].querySelector('textarea').value;

                    const canvas = document.createElement('canvas');
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                const ctx = canvas.getContext('2d');

                // Fill background with a cool-toned gradient
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#89F7FE'); // Light Blue
                gradient.addColorStop(0.5, '#66A6FF'); // Medium Blue
                gradient.addColorStop(1, '#4B79A1'); // Darker Blue
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Add text description above the image
                ctx.fillStyle = '#FFFFFF'; // White text for better contrast on cool background
                ctx.font = `bold ${canvas.width * 0.06}px 'Comic Sans MS', 'Chalkboard SE', cursive, sans-serif`; // Larger font, attempt at chalk-like font
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';

                const textX = canvas.width / 2;
                const textStartY = canvas.height * 0.05; // Position text higher up

                const words = description.split(' ');
                let line = '';
                const lineHeight = canvas.width * 0.07; // Adjusted line height
                let currentY = textStartY;
                let lineCount = 0;
                const maxLines = 4; // Limit to 4 lines to prevent overflow

                for (let n = 0; n < words.length && lineCount < maxLines; n++) {
                    const testLine = line + words[n] + ' ';
                    const metrics = ctx.measureText(testLine);
                    const testWidth = metrics.width;
                    if (testWidth > canvas.width * 0.8 && n > 0) { // Limit text width to 80% of canvas
                        ctx.fillText(line.trim(), textX, currentY);
                        line = words[n] + ' ';
                        currentY += lineHeight;
                        lineCount++;
                    } else {
                        line = testLine;
                    }
                }
                if (lineCount < maxLines) {
                    ctx.fillText(line.trim(), textX, currentY);
                }

                // Draw image, scaled to fill the canvas while maintaining aspect ratio
                const img = new Image();
                img.src = imgElement.src;
                await new Promise((resolve, reject) => {
                    img.onload = resolve;
                    img.onerror = () => reject(new Error('Failed to load image'));
                });

                const imgAspectRatio = img.width / img.height;
                const canvasAspectRatio = canvas.width / canvas.height;

                let drawWidth, drawHeight, imgX, imgY;

                // Calculate image dimensions to fill the remaining space below text
                const availableHeight = canvas.height - (currentY + lineHeight); // Space below text

                if (imgAspectRatio > canvasAspectRatio) {
                    // Image is wider than available space, fit width
                    drawWidth = canvas.width * 0.9; // Use 90% of canvas width
                    drawHeight = drawWidth / imgAspectRatio;
                } else {
                    // Image is taller than available space, fit height
                    drawHeight = availableHeight * 0.9; // Use 90% of available height
                    drawWidth = drawHeight * imgAspectRatio;
                }

                imgX = (canvas.width - drawWidth) / 2;
                imgY = currentY + lineHeight + (availableHeight - drawHeight) / 2; // Position image below text, centered vertically in remaining space

                // Save canvas state before applying shadow and clipping
                ctx.save();
                
                // Add a subtle shadow to the image itself
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)'; // Darker shadow for better contrast
                ctx.shadowBlur = 30;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 20;

                // Draw rounded rectangle for image background
                const cornerRadius = 20; // Adjust for desired roundness
                ctx.beginPath();
                ctx.moveTo(imgX + cornerRadius, imgY);
                ctx.lineTo(imgX + drawWidth - cornerRadius, imgY);
                ctx.quadraticCurveTo(imgX + drawWidth, imgY, imgX + drawWidth, imgY + cornerRadius);
                ctx.lineTo(imgX + drawWidth, imgY + drawHeight - cornerRadius);
                ctx.quadraticCurveTo(imgX + drawWidth, imgY + drawHeight, imgX + drawWidth - cornerRadius, imgY + drawHeight);
                ctx.lineTo(imgX + cornerRadius, imgY + drawHeight);
                ctx.quadraticCurveTo(imgX, imgY + drawHeight, imgX, imgY + drawHeight - cornerRadius);
                ctx.lineTo(imgX, imgY + cornerRadius);
                ctx.quadraticCurveTo(imgX, imgY, imgX + cornerRadius, imgY);
                ctx.closePath();
                ctx.fillStyle = '#000000'; // Black background for the image
                ctx.fill();

                // Clip image to the rounded rectangle
                ctx.clip();

                ctx.drawImage(img, imgX, imgY, drawWidth, drawHeight);

                // Restore canvas state
                ctx.restore();

                // Convert canvas to image and display
                const dataUrl = canvas.toDataURL('image/png');
                const downloadLink = document.createElement('a');
                downloadLink.href = dataUrl;
                downloadLink.download = `app-screenshot-${i + 1}.png`;
                downloadLink.className = 'download-btn';
                downloadLink.innerHTML = 'ðŸ’¾ Download';

                const imgPreview = document.createElement('img');
                imgPreview.src = dataUrl;
                imgPreview.alt = `Generated Screenshot ${i + 1}`;

                const downloadButtonsDiv = document.createElement('div');
                downloadButtonsDiv.className = 'download-buttons';
                downloadButtonsDiv.appendChild(downloadLink);

                const generatedDiv = document.createElement('div');
                generatedDiv.classList.add('generated-screenshot');
                    generatedDiv.appendChild(imgPreview);
                    generatedDiv.appendChild(downloadButtonsDiv);
                    generatedScreenshotsDiv.appendChild(generatedDiv);
                    
                    // Store canvas data for ZIP download
                    generatedDiv.dataset.canvasData = dataUrl;
                    generatedDiv.dataset.filename = `app-screenshot-${i + 1}.png`;
                }
            } catch (error) {
                console.error('Error generating screenshots:', error);
                alert('An error occurred while generating screenshots. Please try again.');
            } finally {
                // Reset button state
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate App Store Screenshots';
                
                // Show download all button if screenshots were generated
                const generatedItems = document.querySelectorAll('.generated-screenshot');
                if (generatedItems.length > 0) {
                    document.getElementById('downloadAllContainer').style.display = 'block';
                }
            }
        });
        
        // Real ZIP download functionality using JSZip
        document.getElementById('downloadAllBtn').addEventListener('click', async () => {
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            const generatedItems = document.querySelectorAll('.generated-screenshot');
            
            if (generatedItems.length === 0) {
                alert('No screenshots to download!');
                return;
            }
            
            // Check if JSZip is available
            if (typeof JSZip === 'undefined') {
                alert('JSZip library is not loaded. Please refresh the page and try again.');
                return;
            }
            
            // Prevent multiple clicks during download
            if (downloadAllBtn.disabled) return;
            downloadAllBtn.disabled = true;
            downloadAllBtn.textContent = 'ðŸ“¦ Creating ZIP...';
            
            try {
                // Create a new JSZip instance
                const zip = new JSZip();
                
                // Add each screenshot to the ZIP
                generatedItems.forEach((item, index) => {
                    const canvasData = item.dataset.canvasData;
                    const filename = item.dataset.filename || `app-screenshot-${index + 1}.png`;
                    
                    if (!canvasData) {
                        console.warn(`No canvas data found for item ${index + 1}`);
                        return;
                    }
                    
                    try {
                        // Convert data URL to base64 data (remove the data:image/png;base64, prefix)
                        const base64Data = canvasData.split(',')[1];
                        // Add file to ZIP
                        zip.file(filename, base64Data, { base64: true });
                    } catch (conversionError) {
                        console.error(`Error adding ${filename} to ZIP:`, conversionError);
                    }
                });
                
                // Check if any files were added
                if (Object.keys(zip.files).length === 0) {
                    alert('No valid screenshots found to download!');
                    return;
                }
                
                downloadAllBtn.textContent = 'ðŸ“¦ Generating ZIP...';
                
                // Generate the ZIP file
                const zipBlob = await zip.generateAsync({
                    type: 'blob',
                    compression: 'DEFLATE',
                    compressionOptions: {
                        level: 6
                    }
                });
                
                // Create download link for the ZIP file
                const url = URL.createObjectURL(zipBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'app-store-screenshots.zip';
                a.style.display = 'none';
                document.body.appendChild(a);
                
                // Trigger download
                a.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                alert(`Successfully created ZIP file with ${Object.keys(zip.files).length} screenshots!`);
                
            } catch (error) {
                console.error('Error creating ZIP file:', error);
                alert('An error occurred while creating the ZIP file. Please try again.');
            } finally {
                // Reset button state
                downloadAllBtn.disabled = false;
                downloadAllBtn.textContent = 'ðŸ“¦ Download All as ZIP';
            }
        });
    </script>
</body>
</html>